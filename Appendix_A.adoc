:toc-placement!:
:imagesdir: ./

== Appendix. Basics of the Version Control System Git

So you wrote a great application, and it worked as expected. Sometime later you've got an idea how to make it even better. After several hours of making changes in your code you've noticed that the application has new bugs in the code that was working fine yesterday. But where is that yesterday's version of the code that was working fine? Can you undo (_rollback_) the latest changes that broke the working code?

Many years ago programmers simply were creating backup copies of their code now and then. After some time their hard drives would have multiple folders named like _TicTacToe_Feb_1_, _TicTacToe_Feb_5_, _TicTacToe_Feb_20_ an so on. But programmers often work in teams, and what if Joe and Mary are working on the same application? How to make sure that Joe's and Mary's computers have the working copy of the application with the ability to keep the history of code changes and return to a working version if need be?

Programmers use a special software called Version Control Systems (VCS) that allows to keep track of different versions of the source code stored in common _source code repositories_ located on the company's servers. There are also special web hosting facilities, where Joe and Mary can safely keep their application code.

Software developers make changes in their local copies of the application's code, and test them. When the local version of the application works fine, they _commit_ the latest code to the source code repository. If Mary has committed her changes, Joe can _check out_ the latest code from the shared repository to his computer. Mary's changes will merged with Joe's ones on his computer.

Now Joe has the latest Mary's code, but she doesn't have the latest Joe's code changes. When Joe decides to commit his latest code to the shared repository, Mary can check them out to her computer. 

In this appendix I'll introduce you to a popular VCS called Git and to the code hosting facility called GitHub. VCS are used by programmers writing code in any languages, not only in Java. As a matter of fact you can keep track of any files using Git and store them in GitHub or other hosts. If your computer get lost or stolen you can always recover the code by _pulling_ it from GitHub.

I was using Git as a VCS and GitHub as a shared repository of the drafts of all chapters of this book, and you can find them on the GitHub at https://github.com/yfain/Java4Kids_NoStarchPress[https://github.com/yfain/Java4Kids_NoStarchPress].  

Understanding how VCS work is very important - that's why I included this short Git tutorial in the book about Java.

=== Two Types of Version Control Systems

There are two types of VCS: centralized and distributed. With centralized systems the source code repository is stored a server, which is _the only_ place that has the latest version of the application as well as all historical files committed by developers in the past. 

[[FIG14-1]]
image::images/fig_14_CentralRepo.png[] 

If Pete, the new programmer, joins the team, he'd need to check out the latest code from the central repository and start making his code modifications on his computer. There are many centralized VCS, and some the most popular are CVS, SVN, and Perforce.

Distributed VCS store the latest version of the code as well as all historical files _on each_ programmer's computer. Popular distributed VCS are Git, Mercurial, and Bazaar. Technically, if you work alone, you can install Git on your computer and have your private VCS without using any remote server as a shared repository. But again, having an extra copy of your project files on a remote server is always a good idea. 

Programmers usually work in teams, so the following diagram shows three computers - one shared repository on the right and to local repositories (Mary's and Joe's) on the left. 

[[FIG14-2]]
image::images/fig_14_DistrRepo.png[] 

At any given time each local repository has all historical updates made by its owner as welled as historical updates that the owner pulled from the shared repository. With centralized VCS Mary and Joe can exchange code only through the central repository, but with distributed systems they can exchange the code directly. Let's see how to create the code repository of your computer that's controlled by Git.

=== Introduction to Git

Git is a free distributed VCS, which you can download and install from http://git-scm.com[http://git-scm.com]. There is a chance that your computer already has Git installed, and you can check it out by opening a Command or Terminal window and entering the command _git_. If it print a list of available Git commands, you already have Git installed. But still, I'd suggest to install the latest Git version by following http://git-scm.com/book/en/v2/Getting-Started-Installing-Git[these instructions] for your operational system. 

There are several http://git-scm.com/download/gui/linux[GUI tools] for working with Git repositories, but we'll be using simple Command or Terminal window for performing all commands. After the installation is complete, enter the command _git --version_, and you'll see which version of Git you'll be using.  

==== Introducing Yourself to Git

The next step is to introduce yourself to Git by providing your name and the email address. Typically you'll be running the _git_ program followed by the command name, which may have various options that start with _--_ or _-_. To introduce yourself to Git, use the _config_ command with the _--global_ option. This is how I did it:  
 
[source, html]
----
git config --global user.name ‚ÄùYakov Fain" 
git config --global user.email "yakovfain@gmail.com"
----

Later on, when you'll be opening a GitHub account you'll need to use the same email as you used with the _config_ command above. The Git is ready to manage your projects. Now let's create a Git repository for a specific project and learn how to work with it.

=== Creating a New Git Repository

For illustration purposes I'll create a new folder called _gitIntro_ and will copy there the files _Pet.java_, _Fish.java_, and _PetMaster.java_ from Chapter 3. Then I'll  open my Terminal window and will create a new Git repository by entering the command _git init_. The content of my _gitIntro_ folder looks as follows:

[[FIG14-3]]
image::images/fig_14_git_init.png[] 

Now this folder has my Java classes and a hidden directory called _.git_, which is a Git repository for my _gitIntro_ project. This directory contains a Git database (a.k.a the index) to store all the changes I'll be making to my Java classes plus the name of the _code branch_ that we'll discuss a bit later.

You can start using Git with your old projects any time you want. Just open the directory of any existing project and execute the _git init_ command to create a new local repository. Of course, it won't know about your prior code modifications, but from now on you can start tracking them. 

=== Selected Git Commands

Git has a couple of dozens commands, but knowing just a half dozen of them may be enough for all your project activities. I'll show you several commands that I use daily. Each command may be issued with several options. I'll just show you the basic commands to quickly get you started with Git. For more detailed coverage of all Git features and commands you'll need to study http://git-scm.com/doc[online documentation]. 

Typically, my work with Git-controlled projects consists of the following activities:

1. Make the changes to some project files.
2. Check the status of your project.
3. Change the status of all or some of the modified files to trackable by running the _add_ command. 
4. Commit all or selected modified files to local Git repository.
5. Push the changes to a shared remote repository.
6. Repeat.

==== The status Command

I always start working with Git by opening my project directory and typing _git status_ to see which files I've modified since my last commit. Let's do it in the directory _gitIntro_. Since I've never committed any files to my brand new code repository just yet, Git will respond with the following status:

[[FIG14-4]]
image::images/fig_14_git_status.png[] 

Note the first statement indicating that I work with the code branch called master. At this point I have no any other branches. The untracked files are displayed in red, which means that they are either new to Git or have been modified after the last commit to the repository. The changes made to the untracked files are not stored in the Git database.

==== The add Command

Adding files to a Git repository is done by the command _add_. I was learning Git by watching training videos recorded by Git engineers, and they've compared the _add_ command with the process of adding items to a shopping cart in a supermarket. There are lots of produce on the shelves, but you pick only selected ones by placing them into your cart. Similarly, you have lots of files in your project's folder(s), but you may want to add only selected ones to the git repository, for example _git add Fish.java_. 

NOTE: If you want to know which options exist for a command, jut enter _git --help_ followed by a command name, for example, _git --help add_. To quit the help mode just enter the letter _q_ in the Command window.

You can also add all new or modified files in one shot by executing the command _git add --all_. After running this command you'll get the following output:

[[FIG14-5]]
image::images/fig_14_git_add_all.png[]

Now all my Java files are shown in green, which means that these files are ready to be committed to the Git database.

==== The commit Command

If we'll continue using the analogy with a supermarket, committing is similar to paying for the products in your shopping cart. But when you pay at the cash register, you get a receipt, right? On the same note, when you issue a _commit_ command, you need to write a comment about what are you committing. Programmers make multiple commits over the life of each project, and such comments allow to keep tracks of the code changes being made.

For example, you can issue the following command:

[source, html]
----
git commit -m "initial commit of the classes Fish, Pet, and PetMaster". 
----

The _-m_ option allows to write a short message describing the commit in the double quotes. 

[[FIG14-6]]
image::images/fig_14_git_commit.png[]

The "63 insertions" here means that total of 63 lines were inserted in the Git database. 

If you would run the _git commit_ command without any options, Git would open a text editor where you should enter a detailed description of changes being committed. Saving this file will store this description in the Git database.

If you'll enter the command _git status_ again you'll see the message that there is nothing to commit. No wonder, I just committed three files and haven't modified them again just yet. 

[[FIG14-7]]
image::images/fig_14_git_nothing_to_commit.png[]

Now let me make a small change in the file _PetMaster.java_. Currently it has the following content:

[source, java]
----
/**
 * Created by NewProgrammer on 3/28/15.
 */
public class PetMaster {

  public static void main(String[] args) {

    String petReaction;
    Pet myPet = new Pet();
    myPet.eat();

    petReaction = myPet.talk("Tweet!! Tweet!!");

    System.out.println(petReaction);
    myPet.sleep();
  }
}
----

I'll just modify a comment at the top of this file. I'll change the text to "Created by Yakov on 3/28/15." Running the _git status_ command again will produce a different output:

[[FIG14-8]]
image::images/fig_14_git_status_changed.png[]

Git has notices that the file _PetMaster.java_ has been changed, but until I issue the command _add_ for this file (or all files), Git won't track the changes in the current version of _PetMaster.java_. In the supermarket setup, it's a situation when the product is displayed on the shelf, you noticed it but have not added to your shopping cart yet. The following two commands will save my latest change in the Git database:

[source, html]
----
git add PetMaster.java
git commit -m "Modified the opening comment in PetMaster.java"
----

After committing all the changes _git status_ will tell us again that there is nothing to commit, and the working directory is clean. 

To summarize, we have three Java classes located in our working directory _gitIntro_, and the history of modifications and commits is stored in the directory _.git_. I also want to remind you that all the work we've done so far was saved only in the local code repository.

==== The reset Command

Here's another scenario to consider. I've just committed the changes to the file _PetMaster.java_ and... got goose bumps. Suddenly I realized that it was a mistake, and I wanted to undo the last commit. The file _PetMaster.java_ has an opening statement "Created by Yakov on 3/28/15.", but I changed my mind and don't want to reveal my name. Luckily Git stores every code changes (the deltas) as they were made in its database. 

I'll show you how to undo the last commit and remove the code changes in _PetMaster.java_. When you'll be trying to repeat all these commands open the file _PetMaster.java_ and note the text of its opening comment, because it's going to change right after the _reset_ command:

[source, html]
----
git reset HEAD
----

The _reset_ command will undo the last commit and will open a text editor containing the description of this  reverted commit, which can look as follows:

[source, html]
----
Revert "modified the opening comment in PetMaster.java"

This reverts commit 6e18f1c5f437650c1a115c9875403fb9d081f15d.

# Please enter the commit message for your changes. Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# On branch master
# Changes to be committed:
#	modified:   PetMaster.java
#
----

You can change this text to better describe what has been done by this _reset_ command. Git will store the saved message in its history files. The 40-character long sequence of digits and letters is a unique code associated with each commit. 

So far we've been working with the default branch called master, and I'll explain you what branches are for next.

==== Branching Commands

You may ask, "What if Mary wants to add a new feature to the application, but she's afraid that her new code may introduce bugs in the working code?" There is a solution to this - Mary can create her own _branch_ to keep her experimental code separately from the main branch. 



==== Push and Pull

If you have a shared Git repository on a remote computer, once in a while you'll need to synchronize the content from your local Git repository with remote one, which may be used by other members of the team. I wrote "maybe" because even if you work on the project alone, you may want to have an extra copy of your Git repository in the remote computer.

The process of downloading of the latest code from the shared repository to your computer is called _pull_. 

The process of uploading your latest code to the shared repository is called _push_. So you commit to a local Git repository, and push to the remote one.


==== Conflict resolution



You can find more detailed explanations of all Git features in the free book titled http://git-scm.com/book/en/v2[Pro Git] published by Apress.

=== Publishing your code on GitHub 

==== Cloning  

Say, Peter join the existing project and Joe and Mary want him to get the existing code installed. Peter will also use Git and GitHub, so he needs to install Git on his computer, but there is no need to create a new folder and issue the _git init_ command there. Git has a _clone_ command that can take the existing code from the shared repository and create its copy on Peter's computer. The clone command not only downloads the latest version of the project's code, but also downloads the entire Git database with all the history of changes made by Joe and Mary in the past.

I store all code examples for this book on GitHub at https://github.com/yfain/Java4Kids_NoStarchPress_code[https://github.com/yfain/Java4Kids_NoStarchPress_code]. You can clone my Git repository from GitHub and start using, improving, or adding new code samples. Just visit the above Web page and copy the URL from the box HTTPS clone URL on the right hand side:

[[FIG14-12]]
image::images/fig_14_CloneURL.png[]

You can see only a part of this URL, but when you copy it into the clipboard it'll look like this:

[source, html]
----
https://github.com/yfain/Java4Kids_NoStarchPress_code.git
----

Now open the Command (or Terminal) window and issue the clone command using the above URL as a parameter:

[source, html]
----
git clone https://github.com/yfain/Java4Kids_NoStarchPress_code.git
----

In a couple of seconds you'll find the directory _Java4Kids_NoStarchPress_code_ with all code samples and the _.git_ folder inside. This is how I did it on my Mac computer:

[[FIG14-13]]
image::images/fig_14_Cloning.png[]

As a matter of fact you can clone any GitHub open source repository on your computer and work with the code without even notifying the author of the code. But creating a clone doesn't mean that you can push your code changes to the author's GitHub repository without his approval. GitHub has special procedures for this called Forking and Pull Requests.

==== Forking and Pull Requests

If cloning creates a copy of someone's remote repository on your computer, forking creates a copy of that GitHub repository in your GitHub repository. Then you can clone this project from your own GitHub account, and work with it as if it's yours. Then if you want to contact the author offering your version of the code, you need to send a _pull request_ to the author. By creating a pull request you are saying to the author, "I just improved your code and committed it into my repository. Please look at it and pull it from me if, you like it". 

Say you want to be a contributor to my code samples for this book. Instead of cloning explained in the previous section, just go to the GitHub page of my project and click on the button Fork at the top of the page:

[[FIG14-14]]
image::images/fig_14_Fork.png[]

This will create a new repository under your GitHub account and will copy my code there. Then you can clone this project from your repository and work with it. When you've improved my code or fixed a bug, push it to your forked project. Then visit my GitHub page and press the button Pull Request there:

[[FIG14-15]]
image::images/fig_14_PullRequest.png[]

You'll be able to create a pull request and describe the code change that you've already inplemened and commited into the forked repository. Actually, I have one pull request at the time of this writing. Let's click on this little circle with the digit 1 and see what's there:

[[FIG14-16]]
image::images/fig_14_PullRequest_YF.png[]

The user with the ID wbrehaut found a typo in my file _CreatePlayStation4Objects.java_. After looking at the code in this file I saw that it's a typo indeed, and pressing the green button Merge pull request will automatically merge the correct line into my code.

The following diagram illustrates this process:

[[FIG14-17]]
image::images/fig_14_Forking.png[]

Not every pull request can be automatically merged, especially if multiple code changes have been done. In this case you'd need to do a manual merge right in the GitHub. I always leave a Thank You comment to people who helped making my code better. 

==== Cloning From IntelliJ IDEA

All popular Java IDE support working with Git. In IDEA open the menu VCS and select the menu item Checkout from Version Control and then GitHub as shown below.

[[FIG14-20]]
image::images/fig_14_IDEA_vcs1.png[]

IDEA will ask you to login to GitHub. Use the email and the password that you used while creating your GitHub account. Then IDEA will ask you for its own password database - leave it blank. Now IDEA is ready to clone any public repository provided that you know the clone URL, which is https://github.com/yfain/Java4Kids_NoStarchPress_code.git in our case. You should enter this URL in the next window that may look similar to this one:

[[FIG14-21]]
image::images/fig_14_IDEA_vcs2.png[]

The field with the name of the project directory will be populated automatically, but you can change it if you want. Press the button Clone and IDEA will clone all the projects into the specified directory and will ask you if you want to open a project. Selecting Yes will open one of the IDEA projects (e.g. Chapter7). You'll also see a warning about unregistered VCS root, which you can ignore, as you won't be directly pushing any code changes into my GitHub repository.

If you'll open the project directory with File Manager (or Finder), you'll see there other folders that contain code samples for all the chapters. You can open any of these projects in IDEA by selecting the menu File | Open. 
Note that this project directory has a folder named _.git_, which contains Git database with the history of all commits that I did while writing code samples for this book.

If you see any compilation errors, open the menu File | Project Structure and make sure that the project language level is set to "8 - Lambdas, type annotations etc."  



