<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Chapter 11. Working With Files and Serialization</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h1, h2 { letter-spacing: -0.01em; }

dt, th.tableblock, td.content { text-rendering: optimizeLegibility; }

p, td.content { letter-spacing: -0.01em; }
p strong, td.content strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after, a[href^="mailto:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img { page-break-inside: avoid; }
  thead { display: table-header-group; }
  img { max-width: 100% !important; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_chapter-11-working-with-files-and-serialization"><a class="anchor" href="#_chapter-11-working-with-files-and-serialization"></a>Chapter 11. Working With Files and Serialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After a program ends it gets erased from memory. When you run it again, its content is loaded into memory and all Java objects are created from scratch. If you’d like to save some results of the program execution, they must be stored in files on a hard disk, a solid-state drive, a memory stick, or other device that can store the data for a long time.</p>
</div>
<div class="paragraph">
<p>In this chapter you’ll learn how to save data on disks and read them back into memory using Java Input/Output(I/O) streams.A program can open an <em>output stream</em> with a file on disk and write the important data there. Similarly, you can open an <em>input stream</em> and read the data from a file.</p>
</div>
<div class="paragraph">
<p>For example, if a player wins a game and  you want to save the score, you can save it in a file called scores.txt using an output stream. If you want to save the player&#8217;s preferences (e.g. colors or fonts) you can save them in a file, and read and apply them when the user runs your program again.</p>
</div>
<div class="paragraph">
<p>A program reads or writes data from/to a stream serially byte after byte, character after character, etc.  Since your program may use different data types like <code>String</code>, <code>int</code>, <code>double</code>, you should use an appropriate Java stream, for example a byte stream, a character stream, or a data stream.</p>
</div>
<div class="paragraph">
<p>In this chapter I&#8217;ll show you how to use I/O streams with files located in your computer. In the next chapter you&#8217;ll learn about I/O streams that can work with remote data located in other computers connected into a network.</p>
</div>
<div class="paragraph">
<p>All classes that can work with file streams are located in packages  <code>java.io</code> and <code>java.nio</code>.  Classes from the <code>java.io</code>
implement blocking I/O: When bytes are being read/written, they become unavailable for other threads of execution. This may not be an issue with small files like a history of game scores, but may become an issue with large files that contain a gigabyte or more. The package <code>java.nio</code> offers a set of classes with improved performance as well as some useful utility classes.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll start with explaining you the basics of working with streams of bytes using classes from the <code>java.io</code> package, and then give you some examples of working with classes from <code>java.nio</code>.</p>
</div>
<div class="sect2">
<h3 id="_basics-of-working-with-streams"><a class="anchor" href="#_basics-of-working-with-streams"></a>Basics of Working With Streams</h3>
<div class="paragraph">
<p>Think of a stream as a pipe. If you just need to read the data you have one pipe where the data flow through this pipe from the data source into your program. If you need to write the data into a storage, it&#8217;s another pipe where the data flow from your program. As with any pipe, it has to be opened to start the flow and closed to stop it.</p>
</div>
<div class="paragraph">
<p>Java supports several types of streams, but no matter what type you are going to use, the following three steps should be done in your program:</p>
</div>
<div class="paragraph">
<p>• Open a stream that points at some data store e.g. a local or remote file.</p>
</div>
<div class="paragraph">
<p>• Read or write data from/to this stream.</p>
</div>
<div class="paragraph">
<p>• Close the stream (Java can do it automatically).</p>
</div>
<div class="paragraph">
<p>In the real world people use different types of pipes for carrying different contents (e.g. gas, oil, milkshakes). Similarly, Java programmers use different classes depending on the type of data they need to carry over a stream. Some streams are used for carrying text, some for bytes, et al.</p>
</div>
<div class="sect3">
<h4 id="_byte-streams"><a class="anchor" href="#_byte-streams"></a>Byte Streams</h4>
<div class="paragraph">
<p>To create a program that reads a file, interprets and displays its content on the screen, you need to know what type of data is stored in this file. On the other hand, a program that just copies files from one place to another, does not even need to know is it an image, a text, or a file with music. Such a copy program reads the original file in memory as a <em>set of bytes</em>, and then writes them into a destination folder..</p>
</div>
<div class="paragraph">
<p>Originaly <code>java.io</code> package have not offered a fast way to copy files and you&#8217;d need to write a program that reads byte after byte using Java classes <code>FileInputStream</code> or <code>FileOutputStream</code>.</p>
</div>
<div class="paragraph">
<p>If your program has to work only with text files, you could use the classes <code>Reader</code> and <code>Writer</code>, which are specifically meant for reading character streams.</p>
</div>
<div class="paragraph">
<p>After selecting the appropriate class you&#8217;ll be invoking one of its methods to read or write the file. For example the <a href="http://docs.oracle.com/javase/8/docs/api/java/io/FileInputStream.html">online documentation</a> of the class <code>FileInputStream</code> includes the method <code>read</code> having the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public int read() throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should tell you that the method <code>read</code> returns an integer value and may throw the <code>IOException</code>, which is an error that may happen if the file is corrupted or deleted, a device failure happened et al. Hence, you must enclose the invocation of the method <code>read</code> into a try-catch block as explained in Chapter 9. To get a specific reason of this exception you&#8217;ll call the method <code>getMessage</code> on the exception object.</p>
</div>
<div class="paragraph">
<p>Each byte in a file is represented by a code, which is a positive integer number. The method <code>read</code> returns the value of this code.</p>
</div>
<div class="paragraph">
<p>The next example shows how to use the class <code>FileInputStream</code> to read the bytes from a file named <em>abc.dat</em>. This little program won&#8217;t interpret the meaning of each byte - it&#8217;ll just print their code values.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll start with creating a new Java project <em>Chapter11</em> in IDEA. Then I&#8217;ll create a new empty file <em>abc.dat</em> in the root folder of the project (right-click on the project name and select the menu New | File). Finally, I&#8217;ll type the following text in <em>abc.dat</em>:</p>
</div>
<div class="paragraph">
<p><em>This is a test file</em></p>
</div>
<div class="paragraph">
<p>Then I&#8217;ll create a new Java class <code>MyByteReader</code> that will read and print the content of the file <em>abc.dat</em>. But let&#8217;s pretend that we don&#8217;t know that the content of this file is text - I want to read it byte by byte and print each byte&#8217;s code (not a letter) separated by a space character. The class <code>MyByteReader</code> will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.FileInputStream;
import java.io.IOException;

public class MyByteReader {

  public static void main(String[] args) {

    try (FileInputStream myFile =             <i class="conum" data-value="1"></i><b>(1)</b>
              new FileInputStream("abc.dat")){

      int byteValue;

      while ((byteValue = myFile.read()) != -1) { <i class="conum" data-value="2"></i><b>(2)</b>

          System.out.print(byteValue + " ");   <i class="conum" data-value="3"></i><b>(3)</b>
      }
    } catch (IOException ioe) {                <i class="conum" data-value="4"></i><b>(4)</b>
        System.out.println("Could not read file: " +
                ioe.getMessage());
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First we open the file for reading (using a default character set) by creating an instance of the class <code>FileInputStream</code> passing the file name <code>abc.dat</code> as a parameter. In Chapter 9 you&#8217;ve learned the syntax of the try-catch blocks. But here I use a special syntax called <em>try-with-resources</em>. When there are some program resources that has to be opened and closed (e.g. <code>FileInputStream</code>), just instantiate them in parentheses right after the <code>try</code> keyword and Java will close them for you automatically. This spares you from writing a <code>finally</code> block containing the code for closing resources.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This line starts a <code>while</code> loop that calls the method <code>read()</code>, which reads one byte, assigns its value to the variable <code>byteCode</code>, and compares it with <code>-1</code> (the end of file indicator).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the value in the current byte is not equal to <code>-1</code>, we print it followed by a space character. The loop ends when it reads the <code>-1</code> byte.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If an <code>IOException</code> occurs, catch it and print the reason of this error.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running this program prints the following numbers that represent encoding of the text "This is a test file":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">84 104 105 115 32 105 115 32 97 32 116 101 115 116 32 102 105 108 101</code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing bytes into a file works similarly, but you&#8217;d use the class <code>FileOutputStream</code> and its method <code>write()</code> as shown in the program <code>MyByteWriter</code> below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.FileOutputStream;
import java.io.IOException;

public class MyByteWriter {

  public static void main(String[] args) {

    // Some byte values represented by integer codes
    int someData[]= {56,230,123,43,11,37};   <i class="conum" data-value="1"></i><b>(1)</b>

    try (FileOutputStream myFile = new FileOutputStream("xyz.dat")){            <i class="conum" data-value="2"></i><b>(2)</b>

        int arrayLength = someData.length;

        for (int i = 0; i &lt; arrayLength; i++){
            myFile.write(someData[i]);        <i class="conum" data-value="3"></i><b>(3)</b>
        }
    } catch (IOException ioe) {
        System.out.println("Could not write into the file: " + ioe.getMessage());     <i class="conum" data-value="4"></i><b>(4)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The program <code>MyByteWriter</code> populates an array <code>someData</code> with integer codes that may represent some characters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then the program opens the file <em>xyz.dat</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and writes each of the integers into the file.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If an error occurs, we catch it and print the reason.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bufferred-streams"><a class="anchor" href="#_bufferred-streams"></a>Bufferred Streams</h4>
<div class="paragraph">
<p>The code examples in the Byte Streams section were reading or writing into a a file one byte at a time. One invocation of <code>read</code> would read one byte, and one invocation of <code>write</code> would write one byte. In general, disk access is much slower than the processing performed in memory; that’s why it’s not a good idea to access the disk a thousand times to read a file of 1,000 bytes. To minimize the number of times the disk is accessed, Java provides buffers, which serve as reservoirs of data.</p>
</div>
<div id="FIG11-1" class="imageblock">
<div class="content">
<img src=".//images/fig_11_BufferedStream.png" alt="fig 11 BufferedStream">
</div>
</div>
<div class="paragraph">
<p>The class <code>BufferedInputStream</code> works as a middleman between <code>FileInputStream</code> and the file itself. It reads a big chunk of bytes from a file into memory (a buffer) in one shot, and the <code>FileInputStream</code> object then reads single bytes from there, which are fast memory-to-memory operations. <code>BufferedOutputStream</code> works similarly with the class <code>FileOutputStream</code>.</p>
</div>
<div class="paragraph">
<p>The main idea here is to minimize disk access.
Buffered streams are not changing the type of the original streams — they just make reading more efficient. A program performs stream chaining (or stream piping) to connect streams, just as pipes are connected in plumbing.</p>
</div>
<div class="paragraph">
<p>The next code listing shows a class <code>MyBufferedByteReader</code>, which is a slightly modified version of <code>MyByteReader</code>. I just attached "another fragment to the pipe" - the <code>BufferedInputStream</code> from the <code>java.io</code> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.BufferedInputStream;
import java.io.FileInputStream;
import java.io.IOException;

public class MyBufferedByteReader {

  public static void main(String[] args) {

    try (FileInputStream myFile = new
                    FileInputStream("abc.dat");  <i class="conum" data-value="1"></i><b>(1)</b>
         BufferedInputStream buff = new
         BufferedInputStream(myFile);){

        int byteValue;

        while ((byteValue = buff.read()) != -1) { <i class="conum" data-value="2"></i><b>(2)</b>

            System.out.print(byteValue + " ");
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we use the try-with-resources syntax again. This time we create an instance of <code>FileInputReader</code> and then and instance of <code>BufferedInputReader</code> providing the <code>FileInputReader</code> as an argument. This is how we connect to fragments of the pipe that uses the file <em>abc.dat</em> as the source of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Under the hood the <code>BufferedInputReader</code> reads  bytes from disk in chunks into a memory buffer, and then the method <code>read</code> reads one byte at time from memory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The program <code>MyBufferedByteReader</code> produces the same output as <code>MyByteReader</code>, but will work just a little bit faster.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_character-streams"><a class="anchor" href="#_character-streams"></a>Character Streams</h3>
<div class="paragraph">
<p>Text in Java is represented as a set of <code>char</code> values, which are encoded based on the character sets capable to represent alphabet or other symbols used in a particular human language. As you can imagine, the text in English, Ukrainian, and Japanese should use different character encodings. The names of some of the standard character sets for English-speaking people are US-ASCII, UTF-8, and UTF-16.</p>
</div>
<div class="paragraph">
<p>Each JVM has a default character set, which could be changed during the JVM startup. You can also find out what&#8217;s the default character in your Java installation by invoking the method <code>defaultCharset</code> on the class <code>Charset</code>, and I&#8217;ll show how to do it in the section "Reading Text Files".</p>
</div>
<div class="paragraph">
<p>The Java classes <code>FileReader</code> and <code>FileWriter</code> from the package <code>java.io</code> were specifically created to work with text files, but they work only with default character encoding and don’t handle localization properly.</p>
</div>
<div class="paragraph">
<p>For efficiency, the reading can be piped with the <code>BufferedReader</code> or <code>BufferedWriter</code>, which read or write from/to the stream buffering characters. I&#8217;ll show you examples of working with text files in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working-with-files-using-java-nio"><a class="anchor" href="#_working-with-files-using-java-nio"></a>Working With Files Using java.nio</h3>
<div class="paragraph">
<p>The <code>java.nio</code> package contains classes that offer a simplified and more efficient way of working with files, and you&#8217;ll see some useful examples here. But first I&#8217;d like to introduce a classes Path and Paths that will represent a file you&#8217;re planning to work with.</p>
</div>
<div class="sect3">
<h4 id="_using-classes-path-and-paths"><a class="anchor" href="#_using-classes-path-and-paths"></a>Using Classes Path and Paths</h4>
<div class="paragraph">
<p>So far we worked with files located in the root directory of our IDEA project. But files are grouped in directories (folders), which in turn can include nested directories and files. More over, files are represented differently in Windows, Mac OS and Linux operational systems. For example, in Windows the pull path to a file may look like this:
<em>c:\mystuff\games\tictactoeScores.txt</em></p>
</div>
<div class="paragraph">
<p>In Mac OS or Linux disks are not named with letters like <em>c:</em> or <em>d:</em>. For example, the path to user&#8217;s files starts from the <em>Users</em> directory. Besides a backslash is not used for a separator symbol there. A full path to a file <em>tictactoeScores.txt</em> of the user <em>mary</em> may look like this:</p>
</div>
<div class="paragraph">
<p><em>/Users/mary/mystuff/games/tictactoeScores.txt</em></p>
</div>
<div class="paragraph">
<p>So before even opening a file you can create an instance of the object <code>Path</code>, which doesn&#8217;t open or reads a file, but represents the location of the file on the disk.</p>
</div>
<div class="paragraph">
<p>There is a special class <code>Paths</code> (yes, in plural) that includes a number of static methods, and in particular, can build the <code>Path</code> object for you. For example, you can invoke the method <code>get</code> passing the name of the file as the argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Path path = Paths.get("abc.dat");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we specified just the file name without a directory, the program will look for the file in the current directory, which in IDEA is the directory of your project (e.g. <em>Chapter11</em>). Outside of the IDE, the current directory is the one where the program was started from.</p>
</div>
<div class="paragraph">
<p>But if we were to create a directory <em>data</em> at the root of our project and move the file <em>abc.dat</em> there, then the <em>relative path</em> to the file starting from the project root would look as <code>"data/abc.dat"</code> on Mac OS or <code>"data\\abc.dat"</code> on Windows. Two backslashes in a Java string correspond to one backslash in the Windows operational system.</p>
</div>
<div class="paragraph">
<p>But your IDEA project is also located in some directory on disk, e.g. <em>chapter11</em>, which is a subdirectory of <em>practicalJava</em>. The file can be represented by the <em>absolute path</em>, which may look like this:</p>
</div>
<div class="paragraph">
<p><em>c:\practicalJava\chapter11\data\abc.dat</em></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p><em>/Users/mary/practicalJava/chapter11/data/abc.dat</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_using-the-class-files"><a class="anchor" href="#_using-the-class-files"></a>Using the Class Files</h4>
<div class="paragraph">
<p>The class <code>Files</code> has several methods that will help you with file manipulations. It can create, delete, rename and copy files. There are methods to read and write files too.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading-a-file"><a class="anchor" href="#_reading-a-file"></a>Reading a File</h4>
<div class="paragraph">
<p>The simplest way to read a file is by calling the method <code>readAllBytes</code> on the class <code>Files</code>. The following line reads the file <em>abc.dat</em> into an array of bytes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">byte[] myFileBytes = Files.readAllBytes(Paths.get("abc.dat");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the file contains text, you can read the file into a <code>String</code> variable like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">String myFileText = new String(Files.readAllBytes(Paths.get("abc.dat")));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to read a text file into a collection, where each element contains one line from the file use the method <code>readAllLines</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">List&lt;String&gt; myFileLines = Files.readAllLines(Paths.get("abc.dat"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>readAllBytes</code> and <code>readAllLines</code> do not use buffers, but for small files is not important.  For more efficient reading you can ask the class <code>Files</code> to create a buffered stream. For example, the program <code>MyTextFileReader</code> uses the method <code>newBufferedReader</code> for more efficient reading. Here I used the same file <em>abc.dat</em> located in the root directory of our IDEA project Chapter11.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package niosamples;

import java.io.BufferedReader;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

public class MyTextFileReader {

  public static void main(String[] args){

    Path path = Paths.get("abc.dat");     <i class="conum" data-value="1"></i><b>(1)</b>
    System.out.println("The absolute path is " +
                         path.toAbsolutePath());

    try {
      if ( Files.exists(path)){         <i class="conum" data-value="2"></i><b>(2)</b>
          System.out.println("The file size is " + Files.size(path));
      }

      BufferedReader bufferedReader=    <i class="conum" data-value="3"></i><b>(3)</b>
               Files.newBufferedReader(path, StandardCharsets.UTF_8);

      String currentLine;

      while ((currentLine =             <i class="conum" data-value="4"></i><b>(4)</b>
             bufferedReader.readLine()) != null){

        System.out.println(currentLine);

      }
    } catch (IOException ioe) {
        System.out.println("Can't read file: " +
                             ioe.getMessage());
    }

    System.out.println(             <i class="conum" data-value="5"></i><b>(5)</b>
           "Your default character encoding is " + Charset.defaultCharset());
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The program starts with creating a <code>Path</code> object from <em>abc.dat</em> and printing its absolute path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then it checks if the file represented by the path exists and prints its size in bytes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here we&#8217;re opening the buffered reader capable of reading text encoded with a character set <code>UTF-8</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Reading the text lines from the buffer.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Print the default character set being used for those who are interested.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When I ran the program <code>MyTextFileReader</code> it printed the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">The absolute path is /Users/yfain11/IdeaProjects/jfk/Chapter11/abc.dat
The file size is 19
This is a test file
Your default character encoding is UTF-8</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now make an experiment to see if the <code>IOException</code> is thrown if the file is not found where expected to be. Just move the file <em>abc.dat</em> into a different directory and re-run <code>MyTextFileReader</code>. Now the console output looks different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Can't read file: abc.dat
Your default character encoding is UTF-8</code></pre>
</div>
</div>
<div class="paragraph">
<p>This output was produced by the <code>catch</code> section from <code>MyTextFileReader</code> where the code invoked the <code>getMessage</code> method on the <code>IOException</code> object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_writing-into-a-file"><a class="anchor" href="#_writing-into-a-file"></a>Writing Into a File</h4>
<div class="paragraph">
<p>Writing into a file is as reading one. Start with creating create an instance of the <code>Path</code> object.  If you want to write bytes, create a byte array, populate it with data and call the method <code>write</code> on the class <code>Files</code>. If you want to write some text into a file, just convert the text from a <code>String</code> into a byte array and then call the method <code>write</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Path path = Paths.get("data/scores.txt");

Files.write(path, myScore.getBytes(),
                    StandardOpenOption.APPEND);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When your program opens a file for writing, you need to consider different options. For example, you may want to append text to an existing file, hence the above code snippet passes the argument  <code>StandardOpenOption.APPEND</code> to method <code>write</code>. If you want to create a file from scratch every time you run the program, use the option <code>StandardOpenOption.CREATE</code>.</p>
</div>
<div class="paragraph">
<p>The following program <code>MyTextFileWriter</code> writes the text into a file <code>scores.txt</code> in the directory <code>data</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package niosamples;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.time.LocalDateTime;

public class MyTextFileWriter {

  public static void main(String[] args){

    System.out.println("The current directory is "+
         System.getProperty("user.dir"));   <i class="conum" data-value="1"></i><b>(1)</b>

    String myScore =                        <i class="conum" data-value="2"></i><b>(2)</b>
                "My game score is 28000 " +
                     LocalDateTime.now() + "\n";

    Path path = Paths.get("data/scores.txt"); <i class="conum" data-value="3"></i><b>(3)</b>

    try {

        if ( Files.exists(path)){            <i class="conum" data-value="4"></i><b>(4)</b>
            Files.write(path, myScore.getBytes(),
                      StandardOpenOption.APPEND);
        } else {
            Files.write(path, myScore.getBytes(),
                      StandardOpenOption.CREATE);
        }

        System.out.println("The game score was saved at " + path.toAbsolutePath());
    } catch (IOException ioe) {
        System.out.println("Can't write file: "
                             + ioe.getMessage());
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For illustration purposes I want the program to print its current directory, which is stored in a special Java variable <code>user.dir</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then I populate a string with the content "My game score is 28000" and concatenate the current date and time followed by <code>\n</code>, which is the end of line marker.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creating a <code>Path</code> object pointing at the file <code>score.txt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Check if the file <code>score.txt</code> already exists, append the new content to it. If the file doesn&#8217;t exists – create it and write the content there.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The program <code>MyTextFileWriter</code> printed the following on my console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">The current directory is /Users/yfain11/IdeaProjects/jfk/Chapter11
The game score was saved at /Users/yfain11/IdeaProjects/jfk/Chapter11/data/scores.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running <code>MyTextFileWriter</code> twice I opened the file <em>scores.txt</em>. Here&#8217;s what I found there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">My game score is 28000 2015-01-11T09:07:49.352
My game score is 28000 2015-01-11T09:10:11.049</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time the program saved the same score of 28000
attaching the system date and time. Of course, you could calculate and write the real score of a game. This is a simple way of printing the local date and time. The time portion goes after the letter "T" and shows hours, minutes, seconds, and nanoseconds. In the Java package <code>java.time</code> you can find multiple classes and methods providing formatting date and time for pretty printing. Go through Oracle&#8217;s tutorial on working with <a href="http://docs.oracle.com/javase/tutorial/datetime/TOC.html">Date and Time API</a> if interested.</p>
</div>
<div class="paragraph">
<p>For writing small files like <em>scores.txt</em> you don&#8217;t need to use buffered streams. For large files though, use BufferedWriter, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">String myScore = "My game score is 28000 " +
                    LocalDateTime.now() + "\n";
BufferedWrited writer = Files.newBufferedWriter(path, StandardOpenOption.APPEND);

writer.write(myScore)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>MyTextFileBufferedFileWriter</code> shows how to write the game score using <code>BufferedWriter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package niosamples;

import java.io.BufferedWriter;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.time.LocalDateTime;

public class MyTextFileBufferedFileWriter {

  public static void main(String[] args) {

    String myScore = "My game score is 28000 " + LocalDateTime.now() + "\n";

    Path path = Paths.get("data/scores.txt");

    try (BufferedWriter writer =
                    getBufferedWriter(path)) {

        writer.write(myScore);

        System.out.println("The game score was saved at " + path.toAbsolutePath());
    } catch (IOException ioe) {
        System.out.println("Can't write file: " +
                                  ioe.getMessage());
    }
  }

  // The factory of BufferedWriter objects
  private static BufferedWriter getBufferedWriter(Path path) throws IOException{

      if (Files.exists(path)) {
          return Files.newBufferedWriter(path,
                        StandardOpenOption.APPEND);
      } else {
          return Files.newBufferedWriter(path,
                         StandardOpenOption.CREATE);
      }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this class I&#8217;ve moved the code that check if the file exists into a separate method <code>getBufferedWriter</code>. I did it to illustrate so-called <em>factory design pattern</em>. A factory can build different objects, right?  The method <code>getBufferedWriter</code> also builds different instances of a <code>BufferedReader</code> depending on the existence of the file referred by <code>path</code>. In programmers jargon the methods that create and return different object instances based on some parameter are called factories.</p>
</div>
<div class="paragraph">
<p>If you run the program <code>MyTextFileBufferedFileWriter</code> it&#8217;ll produce the same results as <code>MyTextFileFileWriter</code>. If you use these programs for writing short texts you won&#8217;t notice the difference in the speed of execution. But when you need to write large amount of information  <code>MyTextFileBufferedFileWriter</code> will work faster.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command-line-arguments"><a class="anchor" href="#_command-line-arguments"></a>Command-Line Arguments</h3>
<div class="paragraph">
<p>So far all of the code examples had the file names stored right in the code, or as  programmers say, <em>hard-coded</em> in the program.  This means that to create a program that reads a files with a different name you’d have to modify the code and recompile the program, which is not nice. You should create universal programs that can take parameters (e.g.the name of the file) from a command line during the program launch.</p>
</div>
<div class="paragraph">
<p>In the first lesson of this book you&#8217;ve been running the program HelloWorld from a command window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">java HelloWorld</code></pre>
</div>
</div>
<div class="paragraph">
<p>But you&#8217;re allowed to add command-line arguments right after the name of the program, for example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">java HelloWorld Mary Smith</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the program HelloWorld would get two command line parameters: Mary and Smith. If you remember, we always write the method main with a <code>String</code> array as an  argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public static void main(String[] args) {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JVM passes the <code>String</code> array to the main method, and if you start a program without any command line arguments, this array remains empty.  Otherwise, this array will have exactly as many elements as the number of command-line arguments  passed to the program.</p>
</div>
<div class="paragraph">
<p>Let’s see  how we can use these command line arguments in a very simple class that will just print them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public class PrintArguments {

  public static void main(String[] args) {

      // How many arguments we've got?
      int numberOfArgs = args.length;

      for (int i=0; i&lt;numberOfArgs; i++){
          System.out.println("I've got " + args[i]);
      }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This program loops through the array <code>args</code> and prints the arguments received from the command line, if any. Run this program from the Command (or Terminal) Window as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">java PrintArguments Mary Smith 123.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The program will print the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">I've got Mary
I've got Smith
I've got 123</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JVM placed <code>Mary</code> into the array element <code>args[0]</code>, <code>Smith</code> into <code>args[1]</code>, and <code>123</code> into `args[2].</p>
</div>
<div class="paragraph">
<p>Command-line arguments are always being passed to a program as strings.  It’s the responsibility of a program to convert the data to the appropriate data type, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">int myScore = Integer.parseInt(args[2]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s always a good idea to check if the command line contains  correct number of arguments. Do this right in the beginning of the method <code>main</code>. If the program doesn’t receive expected arguments, it should print a brief message about it and immediately stop by using a special method <code>exit</code> of the class <code>System</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">public static void main(String[] args) {
 if (args.length != 3){
  System.out.println(
             "Please provide arguments, for example:");
  System.out.println("java PrintArguments Mary Smith 123");

  // Exit the program
  System.exit(0);
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test your programs that take command-line arguments without leaving IntelliJ IDEA. Just open the menu Run, select Edit Configurations and enter the values in the field Program arguments as shown below:</p>
</div>
<div id="FIG11-1" class="imageblock">
<div class="content">
<img src=".//images/fig_11_commandline.png" alt="fig 11 commandline">
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s write a program to copy files. To make this program working with any files, the names of the original and destination files have to be passed to this program as command-line arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

public class FileCopy {

  public static void main(String[] args) {
    if (args.length != 2) {
       System.out.println(
               "Please provide source and destination file names, for example:");
        System.out.println("java FIleCopy abc.datcopyOfabc.dat");

        // Exit the program
       System.exit(0);
   }
    Path sourcePath = Paths.get(args[0]);
   Path destinationPath = Paths.get(args[1]);
    try {
       Files.copy(sourcePath, destinationPath);
       System.out.println("The file " + args[0] + " is copied to " + args[1]);

    } catch (IOException ioe) {
       System.out.println("Can't copy file: " +
                               ioe.getMessage());
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file copy is done by calling the method <code>copy</code> on the class <code>Files</code>. This program will work fine as long as the destination file doesn&#8217;t exist. You can check for file existence in the program by using the method <code>exists</code> of the class <code>Files</code> as it was done in the class <code>MyTextFileReader</code> earlier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serialization-turning-an-object-into-bytes"><a class="anchor" href="#_serialization-turning-an-object-into-bytes"></a>Serialization: Turning an Object Into Bytes</h3>
<div class="paragraph">
<p>Imagine a building that, with a push of a button, can be turned into a pile of construction materials. Load all these materials on the truck and drive to a different city. On arrival push another button, and the building is magically re-created in its original form. This is what Java serialization is about, but instead of a building we&#8217;ll use a Java object. By “clicking the serialize button” JVM turns an instance of an object into a pile of bytes, and “clicking the deserialize button” re-creates the object.</p>
</div>
<div class="paragraph">
<p>Why would you need such functionality? Say you are working on a board game and want to be able to save the current state of the game so the player and continue playing it tomorrow even if the computer will need to be turned off. The program needs to save the state of the game in a file, and when the player launches the game again, the program should load the saved state and recreate the situation on the board.  Creating a Java class with fields like player name, level, score, lives can be a good way to represent a state of the game.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">class GameState {
   String playerName;
   int level;
   int score;
   int remainingLives;

   // other fields go here
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user selects the menu option <em>Save Game State</em>, the program has to create an instance of the object <code>GameState</code>, assign the values to its fields and save these values in a file. But which format to save these values in? Create a <code>String</code> variable, and concatenate all these values into it separating the values with commas? It&#8217;s a lot of work. Also, you&#8217;d need to remember the order of these concatenated values so when you need to read them you know to which fields of the object <code>GameState</code> to assign them to.</p>
</div>
<div class="paragraph">
<p>Luckily, Java greatly simplifies this process. You can create and instance of the Java object, populate it with the values, and then <em>serialize</em> this instance into a bunch of bytes in a special format that remembers the structure of the class <code>GameState</code>. Accordingly, when you need to re-create the instance of the <code>GameState</code> for these bytes, you can <em>deserialize</em> the object in one shot with all its fields values.</p>
</div>
<div class="paragraph">
<p>A Java object can be serialized if it implements <code>Serializabe</code> interface. It&#8217;s a very simple interface to implement, as it doesn&#8217;t declare any abstract methods. Just add <code>implements Serializable</code> to the class declaration to make a class serializable. The following class <code>GameState</code> will represent the state of the game.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.Serializable;

public class GameState implements Serializable {

    String playerName;                      <i class="conum" data-value="1"></i><b>(1)</b>
    int level;
    int score;
    int remainingLives;

  GameState(String playerName, int Level,   <i class="conum" data-value="2"></i><b>(2)</b>
                   int score, int remainingLives){

    this.playerName = playerName;
    this.level=level;
    this.score=score;
    this.remainingLives = remainingLives;
  }

  public String toString(){                 <i class="conum" data-value="3"></i><b>(3)</b>

    return "PlayerName: " + playerName + ", level:" + level + ", score: " + score +
    ", remainingLives: " + remainingLives;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>GameState</code> class has four fields that describe the current state of the game.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class constructor populates these fields with the values passed as arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We override the method <code>toString</code> to be able to print the content of the fields. The method <code>toString</code> is declared in the class <code>Object</code> - the ancestor of all Java classes. For example, if you write <code>System.out.println(myObject)</code>, Java finds and invokes the <code>toString`method on the object `myObject</code>. You&#8217;ll see this in action in the class <code>GameStateManager</code> below.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Java objects are serialized into an I/O stream of type <code>ObjectOutputStream</code>. You&#8217;ll need to create an instance of <code>OutputStream</code>, pipe it with <code>ObjectOutputStream</code>, and invoke a method <code>writeObject</code>.</p>
</div>
<div class="paragraph">
<p>To deserialize (to read back) a Java object you need to create an instance of <code>InputStream</code>,  pipe it with <code>ObjectInputStream</code>, and invoke a method <code>readObject</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a class <code>GameStateManager</code> that will perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an instance of the class <code>GameState</code> and populate its fields with some data.</p>
</li>
<li>
<p>Serialize this instance of <code>GameState</code> into the file named <code>gamestate.ser</code>.</p>
</li>
<li>
<p>Deserialize the instance of <code>GameState</code> from the file
<code>gamestate.ser</code> into a new object.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;

public class GameStateManager {

  public static void main(String[] args) {

    // Create and populate the GameState object
    GameState gameState =
              new GameState("Mary", 45,28000,3); <i class="conum" data-value="1"></i><b>(1)</b>

    // The file for serialization/deserialization
    Path path = Paths.get("gamestate.ser");      <i class="conum" data-value="2"></i><b>(2)</b>

    saveGameState(path, gameState);              <i class="conum" data-value="3"></i><b>(3)</b>
    System.out.println("The GameStateObject is serialized");

    GameState deserializedGameState =            <i class="conum" data-value="4"></i><b>(4)</b>
                               loadGameState(path);
    System.out.println("Deserialized game state; " +
                             deserializedGameState);
  }

   // Serialize the gameState into a file
  private static void saveGameState(Path path,    <i class="conum" data-value="5"></i><b>(5)</b>
                               GameState gameState) {

    try (ObjectOutputStream whereToWrite =        <i class="conum" data-value="6"></i><b>(6)</b>
          new ObjectOutputStream(Files.newOutputStream(
                    path, StandardOpenOption.CREATE))){

        whereToWrite.writeObject(gameState);      <i class="conum" data-value="7"></i><b>(7)</b>

    } catch (IOException ioe) {
           System.out.println("Can't serialize file: " + ioe.getMessage());
    }
  }

  // Deserialize the GameState from a file
  private static GameState loadGameState(Path path){

      GameState loadedGameState = null;

      try (ObjectInputStream whereToReadFrom =    <i class="conum" data-value="8"></i><b>(8)</b>
                   new ObjectInputStream(Files.newInputStream(path))){

          loadedGameState= (GameState) whereToReadFrom.readObject();      <i class="conum" data-value="9"></i><b>(9)</b>

      } catch (ClassNotFoundException cnfe) {
          System.out.println("Can't find the declaration of GameState: " + cnfe.getMessage());
      }  catch (IOException ioe) {
          System.out.println("Can't deserialize file: " + ioe.getMessage());
      }

      return loadedGameState;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The program starts with creating and populating the game state object. In this example I used hard-coded values, but in a real game they should be taken from the variables that reflect the actual game status.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The serialized file&#8217;s name is <code>gamestate.ser</code> and it&#8217;ll be represented by the <code>Path</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Then we call the method <code>saveGameState</code> that will serialize the object <code>GameState</code> into a file.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After serialization is complete, we deserialize it back into another instance of the game state object. The variable <code>deserializedGameState</code> points at this new instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The method <code>saveGameState</code> is responsible for serializing the object. It takes two parameters - the path to the file and the reference to the object that has to be serialized.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Now we&#8217;re opening the file&#8217;s <code>OutputStream</code> and pipe it up with the <code>ObjectOutputStream</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>It takes just one line of code to serialize the <code>GameState</code> object into the file using the method <code>write</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The method <code>loadGameState</code> deserializes the object from a file, and we&#8217;re opening the <code>InputStream</code> and pipe it up with the <code>ObjectInputStream</code>.The data from file will be read in the same format and order as it was written. So if you&#8217;ll change the declaration of the class <code>GameState</code> between serialization and deserialization, Java will throw <code>InvalidClassException</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>It takes just one line of code to deserialize the file into a <code>GameState</code> object using the method <code>read</code>. In this example the same program serializes and deserializes the game state, but this may not be the case. You can send the serialized object to another computer on the network, and another program may deserialize the <code>GameState</code>. Hence it&#8217;s important that the declaration of the <code>GameState</code> is available on both computers. The exception <code>ClassNotFoundException</code> will be thrown if the declaration of the class <code>GameState</code> is not available.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the program <code>GameStateManager</code>, and you&#8217;ll see that it creates a new file <code>gamestate.ser</code>. Open this file in a text editor, and you&#8217;ll see some gibberish. Java serializes objects in its internal format, which is not meant for reading by the humans. The console output will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">The GameStateObject is serialized
Deserialized the game state
Deserialized game state object; PlayerName: Mary, level:0, score: 28000, remainingLives: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you place the breakpoint right after the invokation of the <code>loadGameState</code> method, you&#8217;ll be able to see two different instances of the <code>GameState</code> object as shown below:</p>
</div>
<div id="FIG11-1" class="imageblock">
<div class="content">
<img src=".//images/fig_11_debug_serialize.png" alt="fig 11 debug serialize">
</div>
</div>
<div class="paragraph">
<p>Note how IDEA conveniently shows the values of the variables not only in the debugger&#8217;s view at the bottom but in the source code of the program in grayed out font.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project-saving-the-game-scores"><a class="anchor" href="#_project-saving-the-game-scores"></a>Project: Saving the Game Scores</h3>
<div class="paragraph">
<p>In this project you&#8217;ll write a program that can keep the history of the game scores in a file by using Java serialization. This program should be able to deserialize and sort the saved scores showing the highest scores on top.</p>
</div>
<div class="paragraph">
<p>To complete this project you need to understand how to compare objects. While comparing two numbers is easy, Java objects may include multiple fields and you need to decide which fields of the object should be compared to place objects in a certain order. In this assignment you&#8217;ll be ordering objects <code>Score</code> so the objects with larger value of the field <code>score</code> should come first. In other words, you&#8217;ll need to sort the objects <code>Score</code> in the descending order of the field <code>score</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a serializable class <code>Score</code> to represent a game score.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">import java.io.Serializable;
import java.time.LocalDateTime;

class Score implements Serializable {
    String name;
    int score;
    LocalDateTime dateTime;

    Score(String name, int score, LocalDateTime dateTime){
        this.name=name;
        this.score=score;
        this.dateTime=dateTime;
    }

    public String toString(){
        return name + " scored " + score + " on " + dateTime;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a class <code>ScoreManager</code> with the method <code>main</code>. Inside <code>main</code> declare and instantiate a collection of scores: <code>List&lt;Score&gt; scores</code>. Create the <code>Path</code> object to point at the file <code>scores.ser</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">List&lt;Score&gt; scores = new ArrayList&lt;&gt;();

Path path = Paths.get("scores.ser");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>ArrayList</code> is one of the Java collections that implements the <code>List</code> interface, so declaring this variable of type <code>List</code> is valid.</p>
</div>
</li>
<li>
<p>Add the methods <code>saveScores</code> and <code>loadScores</code> to the class <code>ScoreManager</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">private static void saveScores(Path path, List&lt;Score&gt; gameScores) {}

private static List&lt;Score&gt; loadScores(Path path){}</code></pre>
</div>
</div>
</li>
<li>
<p>Write the code in the method <code>saveScore</code> to serialize the collection <code>scores</code> into a file <code>scores.ser</code>. Use the code from the class <code>GameStateManager</code> as an example, but this time you&#8217;ll need to serialize not just one object instance, but a collection of objects, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">try (ObjectOutputStream whereToWrite = new ObjectOutputStream(
  Files.newOutputStream(path, StandardOpenOption.CREATE))){

    whereToWrite.writeObject(gameScores);

} catch (IOException ioe) {
    System.out.println("Can't serialize scores: " + ioe.getMessage());
}</code></pre>
</div>
</div>
</li>
<li>
<p>Write the code in the method <code>loadScores</code> to deserialize the data from the file <code>scores.ser</code>
:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">List&lt;Score&gt; loadedScores= null;

try (ObjectInputStream whereToReadFrom =
    new ObjectInputStream(Files.newInputStream(path))){

    loadedScores=
         (List&lt;Score&gt;) whereToReadFrom.readObject();

} catch (ClassNotFoundException cnfe) {
    System.out.println("Can't find the declaration of Score: " + cnfe.getMessage());
}  catch (IOException ioe) {
    System.out.println("Can't deserialize file: " + ioe.getMessage());
}

return loadedScores;</code></pre>
</div>
</div>
</li>
<li>
<p>Starting from this step all coding should be done in the <code>main</code> method of <code>ScoreManager</code>. If the file <em>scores.ser</em> already exists, load the collection of score. If <em>scores.ser</em> doesn&#8217;t exist, create a new collection.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">if (Files.exists(path)) {
    scores = loadScores(path);

} else {
    scores = new ArrayList&lt;&gt;();
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>Score</code> class, populate its fields <code>name</code>, <code>score</code>, and <code>dateTime</code>. Assign a random number generated by the class <code>java.util.Random</code> to the <code>score</code> field. Assign the current date and time to the field <code>dateTime</code> Use the method <code>nextInt</code> to generate a number between 0 and 50000. Add the hew score to the <code>scores</code> collection.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Random numberGenerator = new Random();

Score myScore = new Score("Mary", numberGenerator.nextInt(50000), LocalDateTime.now());

scores.add(myScore);</code></pre>
</div>
</div>
</li>
<li>
<p>Print all the scores and invoke the method <code>saveScore</code> to serialize all <code>scores</code> into the file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">System.out.println("All scores:");
scores.forEach(s -&gt; System.out.println(s));

saveScores(path, scores);</code></pre>
</div>
</div>
</li>
<li>
<p>Sort and print the collection to show the highest score on top. Use the class <code>Comarator</code> to specify that sorting should be done by the field <code>score</code>. For sorting in the descendant order invoke the method <code>reverseOrder</code>. Use the Stream API.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">System.out.println("Sorted scores (highest on top):");
Comparator&lt;Score&gt; byScoreDescending =
        Collections.reverseOrder(Comparator.comparing(s -&gt; s.score));

scores.stream()
        .sorted(byScoreDescending)
        .forEach(s -&gt; System.out.println(s));</code></pre>
</div>
</div>
</li>
<li>
<p>Run the program <code>ScoreManager</code> and observe that all scores are printed in descending order.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-04-24 05:40:32 EDT
</div>
</div>
</body>
</html>